<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pricing Table</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f4f4f4;
        margin: 0;
      }
      select {
        padding: 8px 16px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-left: 10px;
        cursor: pointer;
        background: #ffffff;
        color: #000;
        width: auto;
        display: inline-block;
      }
      .dropdown-container {
        background-color: #000;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
        color: #fff;
        text-align: center;
      }
      .dropdown-label {
        display: inline-block;
        margin-right: 5px;
      }
      .pricing-table {
        display: flex;
        justify-content: space-between; /* Adjust if necessary */
        padding: 20px 0;
        margin-top: 20px;
        width: 1000px;
        margin-left: auto;
        margin-right: auto;
        flex-wrap: wrap; /* Allows wrapping if the screen is too small */
      }
      .pricing-col {
        border: 1px solid #ddd;
        padding: 20px;
        text-align: center;
        transition: all 0.3s ease-in-out;
        background-color: #000;
        color: #ffffff;
        position: relative;
        flex: 1;
        height: 500px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        border-radius: 10px;
        margin: 20px;
        min-width: 250px;
      }
      .pricing-col:hover {
        border-color: rgba(0, 0, 0, 0.3);
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
      }
      .pricing-img {
        width: 100%;
        height: 30%;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        margin-bottom: 20px;
      }
      h2 {
        font-size: 18px;
        margin-top: 15px;
      }
      .btn,
      .btn {
        padding: 8px 16px;
        border: none;
        background-color: #333;
        color: #fff;
        border-radius: 4px;
        font-weight: bold;
        text-decoration: none;
        transition: background-color 0.3s ease-in-out;
        width: 90%;
        height: 50px;
        text-align: center;
        margin: 0 auto;
        display: block;
        cursor: pointer;
        font-size: 16px;
      }
      .btn:hover,
      .btn1:hover {
        background-color: green;
      }
      .popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #333; /* Changed to match button color */
        color: #fff; /* Text color */
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        width: 300px; /* Fixed width */
        text-align: center; /* Center content */
      }

      a {
        text-decoration: none;
      }
      .popup button {
        padding: 8px 16px;
        margin: 10px 0; /* Space between buttons */
        border: none;
        background-color: #64a70b; /* Button color */
        color: #fff;
        border-radius: 4px;
        font-weight: bold;
        text-decoration: none;
        transition: background-color 0.3s ease-in-out;
        width: 80%; /* Button width */
        text-align: center;
        display: block;
        cursor: pointer; /* Cursor style */
      }

      .popup button:hover {
        background-color: green; /* Hover effect */
      }

      .popup button:disabled {
        background-color: grey; /* Hover effect */
      }

      .popup input {
        width: 200px;
        height: 30px;
        padding: 8px 16px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-left: 10px;
        cursor: pointer;
        background: #ffffff;
        color: #000;
        width: auto;
        display: inline-block;
      }

      .popup-close {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
        color: #fff; /* Close button color */
        font-size: 20px; /* Close button size */
      }

      .popup #cancel,
      .popup #submit {
        width: 120px;
        border-radius: 4px;
        height: 40px;
      }

      .popup #errorSpan {
        color: red;
      }

      .popup-button-div {
        display: flex;
        justify-content: space-around;
      }
    </style>
  </head>
  <body>
    <div class="dropdown-container">
      <div class="dropdown-label">Have a Module?</div>
      <select id="moduleSelect">
        <option value="no" selected>No</option>
        <option value="yes">Yes</option>
      </select>
      <div class="dropdown-label">Are you an Authorized GEA Company?</div>
      <select id="companySelect">
        <option value="no" selected>Non-Authorized</option>
        <option value="yes">Authorized</option>
      </select>
      <div class="dropdown-label">Plan Duration:</div>
      <select id="planSelect">
        <option value="monthly">Monthly</option>
        <option value="yearly" selected>Yearly</option>
      </select>
    </div>

    <!-- Pricing Table -->
    <div class="pricing-table" id="pricingTable"></div>
    <div class="popup-overlay"></div>
    <div class="popup">
      <div class="popup-close">X</div>
      <div class="popup-content" id="popupContect"></div>
    </div>
    <script>
      let buyNowButtonClickListener;
      let moduleSelect = document.getElementById("moduleSelect");
      let companySelect = document.getElementById("companySelect");
      let planSelect = document.getElementById("planSelect");
      let pricingTable = document.getElementById("pricingTable");
      let popupContect = document.getElementById("popupContect");
      let validCode = false;

      function openPopup(isModuleIncluded, isAuthorized, isYearly, onlyModule) {
        // Determine the correct links based on the user's selections
        let partsLink = isAuthorized
          ? "https://forms.smarthqpro.com/aparts"
          : "https://forms.smarthqpro.com/parts";
        let creditCardLink;
        if (onlyModule) {
          creditCardLink = isAuthorized
            ? "https://buy.stripe.com/eVa5nX1x5dk74pObJ2"
            : "https://buy.stripe.com/7sI6s17VtbbZbSgfZh";
        } else if (isModuleIncluded) {
          if (isYearly && isAuthorized) {
            creditCardLink = "https://buy.stripe.com/dR62bLb7F3Jx4pObIU";
          } else if (isYearly && !isAuthorized) {
            creditCardLink = "https://buy.stripe.com/4gw8A98Zx7ZN9K800a";
          } else if (!isYearly && isAuthorized) {
            creditCardLink = "https://buy.stripe.com/28o6s1grZ2Ft4pOcN4";
          } else {
            creditCardLink = "https://buy.stripe.com/6oE6s1fnVa7V7C04gt";
          }
        } else {
          if (isYearly && isAuthorized) {
            creditCardLink = "https://buy.stripe.com/eVaaIhb7FeobbSgfZl";
          } else if (isYearly && !isAuthorized) {
            creditCardLink = "https://buy.stripe.com/fZebMlb7Ffsf9K89AV";
          } else if (!isYearly && isAuthorized) {
            creditCardLink = "https://buy.stripe.com/eVa2bL2B96VJ8G4dRe";
          } else {
            creditCardLink = "https://buy.stripe.com/00g8A98Zxdk71dC4gC";
          }
        }

        popupContect.innerHTML = `<h3>Payment Options</h3><a id="creditCard"><button id="creditCard">Pay by Credit Card</button></a><a id="partsAccount"><button id="partsAccount">Pay by Parts Account</button></ a>`;

        // Update the popup with the correct links
        document
          .getElementById("creditCard")
          .setAttribute("href", creditCardLink);
        document.getElementById("partsAccount").setAttribute("href", partsLink);
        // Display the popup
        document.querySelector(".popup").style.display = "block";
        document.querySelector(".popup-overlay").style.display = "block";
      }

function updateModuleBuyLink() {
    let isAuthorized = validCode; // Determine authorization status
    let buyNowLink = isAuthorized
        ? "https://buy.stripe.com/eVa5nX1x5dk74pObJ2" // Link for authorized users
        : "https://buy.stripe.com/7sI6s17VtbbZbSgfZh"; // Link for non-authorized users

    // Get the "Buy Now" button for the replacement module
    let buyNowButton = document.getElementById("mButton");

    if (buyNowButton) {
        if (buyNowButtonClickListener) {
            buyNowButton.removeEventListener("click", buyNowButtonClickListener);
        }

        buyNowButtonClickListener = function(event) {
            event.preventDefault(); // Prevent default button behavior
            window.location.href = buyNowLink; // Redirect to the Stripe link
        };
        buyNowButton.addEventListener("click", buyNowButtonClickListener);
    }
}


      function openAuthPopup(isModuleIncluded, isAuthorized, isYearly) {
        popupContect.innerHTML = `<h3>Input your Service Number</h3><input id="code" type="text" placeholder="Authorized Service Number"><span id="errorSpan" class="error"></span><div class="popup-button-div"><button id="submit">Submit</button><button id="cancel" style="background-color: black;">Cancel</button></ div>`;

        // Update the popup with the correct links
        document.getElementById("cancel").addEventListener("click", closePopup);
        document.getElementById("submit").addEventListener("click", serviceAPI);
        errorSpan.style.display = "none";

        // Display the popup
        document.querySelector(".popup").style.display = "block";
        document.querySelector(".popup-overlay").style.display = "block";
      }

      function closePopup() {
        if (!validCode && companySelect.value === "yes") {
          companySelect.value = "no";
          let event = new Event("change");
          companySelect.dispatchEvent(event);
        }
        document.querySelector(".popup").style.display = "none";
        document.querySelector(".popup-overlay").style.display = "none";
      }

function generateTable() {
    let company = companySelect.value;
    let module = moduleSelect.value;
    let monthly = planSelect.value === "monthly";
    let modulePrice = company === "yes" ? 99 : 199;
    let subscriptionPrice = (company === "yes" ? 40 : 50) * (monthly ? 1 : 12);
    let moduleImgSrc = module === "yes"
        ? "https://uploads-ssl.webflow.com/61d5fc96029694ef0cf8f249/63ff0b4f20f51d2091c6f26a_SmartHQ%20Pro%20Interface-6.png"
        : "https://uploads-ssl.webflow.com/61d5fc96029694ef0cf8f249/644fcc6f17b2c36472c32fc2_SmartHQ%20Service%20Interface.png";

    // Generate the HTML for the pricing table
    pricingTable.innerHTML = `
        <div class="pricing-col" style="border-color: #97D700;">
            <div class="pricing-img" style="background-image: url('${moduleImgSrc}');"></div>
            <h2>SmartHQ Service${module === "no" ? " + Module" : ""}</h2>
            <div style="font-size: 40px; margin-bottom: 20px; color: #97D700; font-weight: bold;">
                $${subscriptionPrice} ${monthly ? "/month" : "/year"}
            </div>
            ${module ? `<div style="font-size: 18px; margin-bottom: 20px;">*Excludes a one-time module cost of $${modulePrice}.</div>` : ""}
            <button class="btn" id="sButton" style="background-color: #64A70B;">Buy Now</button>
        </div>
        <div class="pricing-col" style="border-color: #97D700;">
            <div class="pricing-img" style="background-image: url('https://uploads-ssl.webflow.com/61d5fc96029694ef0cf8f249/64e1d1b844c35d76357a09f3_Service%20Module.png');"></div>
            <h2>Replacement Module</h2>
            <div style="font-size: 40px; margin-bottom: 20px; color: #97D700; font-weight: bold;">$${modulePrice}</div>
            <div style="font-size: 18px; margin-bottom: 20px;">Lost your Bluetooth module? Add an additional one.</div>
            <button class="btn" id="mButton" style="background-color: #64A70B;">Buy Now</button>
        </div>
        <div class="pricing-col" style="border-color: #97D700;">
            <div class="pricing-img" style="background-image: url('https://uploads-ssl.webflow.com/61d5fc96029694ef0cf8f249/6519b3c6af4f709c4a3e72f6_joint-enterprise-business-data-analysis.svg');"></div>
            <h2>Enterprise</h2>
            <div style="font-size: 40px; margin-bottom: 20px; color: #97D700; font-weight: bold;">Custom</div>
            <div style="font-size: 18px; margin-bottom: 20px;">Custom pricing for 10 accounts or more.</div>
            <a href="https://forms.smarthqpro.com/entreprise"><button class="btn" style="background-color: #64A70B;">Contact Us</button></a>
        </div>
    `;

    // Attach event listener to the "Buy Now" button for SmartHQ Service
    document.getElementById("sButton").addEventListener("click", function (event) {
        event.preventDefault();
        let isModuleIncluded = module === "no";
        let onlyModule = false;
        let isAuthorized = validCode;
        let isYearly = !monthly;
        openPopup(isModuleIncluded, isAuthorized, isYearly, onlyModule);
    });

    // Update the event listener for the "Buy Now" button of the replacement module
    updateModuleBuyLink();
}

function updateModuleBuyLink() {

}

      async function serviceAPI() {
        let code = document.getElementById("code").value;
        var button = document.getElementById("submit");

        // Disable the button
        button.disabled = true;

        // Update the button text
        button.innerHTML = "Submitting...";
        console.log(code);

        fetch(`https://serviceform.smarthqpro.com/v1/customer/${code}`, {
          method: "get",
        })
          .then(async (response) => {
            if (response.status === 200) {
              companySelect.value = "yes";
              validCode = true;
              popupContect.innerHTML = `<h3>Valid!</h3>`;
              setTimeout(closePopup, 1000);
            } else {
              validCode = false;
              companySelect.value = "no";
              errorSpan = document.getElementById("errorSpan");
              errorSpan.innerHTML =
                response.status === 404
                  ? "Invalid Service Number"
                  : "Internal Server Error!";
              button.disabled = false;
              button.innerHTML = "Submit";

              errorSpan.style.display = "block";
            }

            let event = new Event("change");
            companySelect.dispatchEvent(event);
          })
          .catch((error) => {
            console.error("Error:", error);
            validCode = false;
            companySelect.value = "no";
            errorSpan = document.getElementById("errorSpan");
            errorSpan.innerHTML = "Internal Server Error!";
            errorSpan.style.display = "block";
            button.disabled = false;
            button.innerHTML = "Submit";
            let event = new Event("change");
            companySelect.dispatchEvent(event);
          });
      }
      moduleSelect.addEventListener("change", generateTable);
companySelect.addEventListener("change", function() {
    validCode = this.value === "yes"; // Update based on new selection
    updateModuleBuyLink(); // Update the Buy Now link
    generateTable(); // Call generateTable if needed
});
      planSelect.addEventListener("change", generateTable);

      document
        .querySelector(".popup-close")
        .addEventListener("click", closePopup);

      document
        .querySelector(".popup-overlay")
        .addEventListener("click", closePopup);

      window.onload = generateTable();
      window.addEventListener("pageshow", function (event) {
        console.log(event);
        if (
          event.persisted ||
          (window.performance && window.performance.navigation.type === 2)
        ) {
          // Run your function here
          generateTable();
        }
      });
    </script>
  </body>
</html>
